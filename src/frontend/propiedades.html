<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Propiedades disponibles</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="pagina-secundaria">

  <header class="navbar navbar-light bg-light shadow-sm">
    <div class="container d-flex flex-wrap justify-content-between align-items-center">
        <a class="navbar-brand" href="index.html">
            <img src="img/icon_cooperativa.png" width="40" height="40" alt="Logo"> Cooperativa
        </a>

        <a href="perfil.html" class="btn btn-outline-secondary btn-sm">Volver a mi perfil</a>
    </div>
  </header>

  <main class="container py-4">
    <div class="row g-2 mb-4">
      <div class="col-12 col-md-4">
        <input id="filtro-busqueda" class="form-control" type="search" placeholder="Buscar por título o descripción...">
      </div>
      <div class="col-6 col-md-4">
        <select id="filtro-dorm" class="form-select">
          <option value="">Dormitorios (todos)</option>
          <option value="1">1+</option>
          <option value="2">2+</option>
          <option value="3">3+</option>
          <option value="4">4+</option>
        </select>
      </div>
      <div class="col-6 col-md-4">
        <select id="filtro-banos" class="form-select">
          <option value="">Baños (todos)</option>
          <option value="1">1+</option>
          <option value="2">2+</option>
          <option value="3">3+</option>
        </select>
      </div>
    </div>
    <div id="grid-propiedades" class="row g-4">
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const PROPIEDADES = [
      {
        id: 101,
        titulo: "Casa A - Bloque Norte",
        descripcion: "Unidad luminosa con orientación norte, cerca del área común.",
        imagenes: [
          "img/casas/casaA_1.png",
          "img/casas/casaA_2.png",
          "img/casas/casaA_3.png",
          "img/casas/casaA_4.png",
          "img/casas/casaA_5.png"
        ],
        banos: 2,
        dormitorios: 3,
        metros: 87
      },
      {
        id: 102,
        titulo: "Casa B - Patio central",
        descripcion: "Ambientes amplios, patio compartido y buena ventilación.",
        imagenes: [
          "img/casas/casaB_1.png",
          "img/casas/casaB_2.png",
          "img/casas/casaB_3.png",
          "img/casas/casaB_4.png",
          "img/casas/casaB_5.png"
        ],
        banos: 1,
        dormitorios: 2,
        metros: 72
      },
      {
        id: 103,
        titulo: "Casa C - Esquina",
        descripcion: "Esquinera, con vista abierta y posibilidad de ampliación.",
        imagenes: [
          "img/casas/casaC_1.png",
          "img/casas/casaC_2.png",
          "img/casas/casaC_3.png",
          "img/casas/casaC_4.png",
          "img/casas/casaC_5.png"
        ],
        banos: 2,
        dormitorios: 4,
        metros: 102
      }
    ];

    function crearTarjeta(prop) {
      const col = document.createElement("div");
      col.className = "col-12 col-md-6 col-lg-4";

      const carouselId = "carousel-" + prop.id;

      const indicadores = prop.imagenes.map((_, idx) => `
        <button type="button" data-bs-target="#${carouselId}" data-bs-slide-to="${idx}" ${idx===0 ? 'class="active" aria-current="true"' : ''} aria-label="Slide ${idx+1}"></button>
      `).join("");

      const slides = prop.imagenes.map((src, idx) => `
        <div class="carousel-item ${idx===0 ? 'active' : ''}">
          <img src="${src}" class="d-block w-100 propiedad-img" alt="${prop.titulo} - imagen ${idx+1}">
        </div>
      `).join("");

      col.innerHTML = `
        <div class="card h-100 shadow-sm propiedad-card">
          <div id="${carouselId}" class="carousel slide propiedad-carousel" data-bs-ride="carousel">
            <div class="carousel-indicators">
              ${indicadores}
            </div>
            <div class="carousel-inner">
              ${slides}
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#${carouselId}" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Anterior</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#${carouselId}" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Siguiente</span>
            </button>
          </div>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title mb-2">${prop.titulo}</h5>
            <p class="card-text text-muted mb-3">${prop.descripcion}</p>

            <div class="d-flex gap-2 mb-3 flex-wrap">
              <span class="chip-dato" title="Baños"><i class="bi bi-droplet-half me-1"></i>${prop.banos} baños</span>
              <span class="chip-dato" title="Dormitorios"><i class="bi bi-house-door me-1"></i>${prop.dormitorios} dorm</span>
              <span class="chip-dato" title="Metros cuadrados"><i class="bi bi-aspect-ratio me-1"></i>${prop.metros} m²</span>
            </div>

            <div class="mt-auto">
              <button class="btn btn-dark w-100 btn-solicitar" data-id="${prop.id}">
                Solicitar
              </button>
            </div>
          </div>
        </div>
      `;
      return col;
    }

    const grid = document.getElementById("grid-propiedades");
    function renderLista(propiedades) {
      grid.innerHTML = "";
      propiedades.forEach(p => grid.appendChild(crearTarjeta(p)));
      document.querySelectorAll(".btn-solicitar").forEach(btn => {
        btn.addEventListener("click", onSolicitar);
      });
    }
    renderLista(PROPIEDADES);

    const $busqueda = document.getElementById("filtro-busqueda");
    const $dorm = document.getElementById("filtro-dorm");
    const $banos = document.getElementById("filtro-banos");

    function aplicarFiltros() {
      const term = ($busqueda.value || "").toLowerCase();
      const minDorm = parseInt($dorm.value || "0", 10);
      const minBanos = parseInt($banos.value || "0", 10);

      const filtradas = PROPIEDADES.filter(p => {
        const coincideTexto =
          p.titulo.toLowerCase().includes(term) ||
          p.descripcion.toLowerCase().includes(term);
        const okDorm = minDorm ? p.dormitorios >= minDorm : true;
        const okBanos = minBanos ? p.banos >= minBanos : true;
        return coincideTexto && okDorm && okBanos;
      });
      renderLista(filtradas);
    }

    $busqueda.addEventListener("input", aplicarFiltros);
    $dorm.addEventListener("change", aplicarFiltros);
    $banos.addEventListener("change", aplicarFiltros);

    // Handler "Solicitar" (placeholder)
    function onSolicitar(e) {
      const id = e.currentTarget.getAttribute("data-id");
      // Aquí puedes hacer un fetch a tu API para solicitar la unidad:
      // fetch("http://localhost:8000/api/solicitudes.php", { method: "POST", body: JSON.stringify({ propiedad_id: id }) ... })
      alert("Solicitud enviada para la propiedad ID: " + id);
    }
  </script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

</body>
</html>
